<p id="notice"><%= notice %></p>
<div class="panel panel-default">
  <div class="panel-heading">Products
    <% if current_user.branch_manager? %>
      <strong class="pull-right"><%= current_user.branch_name %>&nbsp;<small><%= current_user.branch_address %></small></strong>
    <% end %>
  </div>
  <h4> Search </h4>
  <%= simple_form_for(:search, url: products_path, method: :get) do |f| %>
    <%= f.input_field :text, placeholder: "Name || Description", value: get_param["text"] %>
    <%= f.collection_select :category_id, Category.all.order(:name), :id, :name, { prompt: "Category", selected: get_param["category_id"], include_blank: "All" }, onchange: "this.form.submit();" %>
    <%= f.collection_select :branch_id, Branch.all.order(:name), :id, :name, { prompt: "Branch", selected: get_param["branch_id"], include_blank: "All" } , onchange: "this.form.submit();" if current_user.admin? %>
    <%= f.submit :search %>
  <% end %>
  <table class="table">
    <thead>
      <tr>
        <th>Product Name</th>
        <th>Price</th>
        <th>Category</th>
        <th>Available Items</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody>
      <% @products.each do |product| %>
        <tr>
          <td><%= link_to product.name, product %></td>
          <td><%= product.price %></td>
          <td><%= product.category_name %></td>
          <td><%= product.available %></td>
          <% if current_user.branch_manager? %>
            <td>
              <%= link_to edit_product_path(product), class: "btn btn-success" do %>
                <i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit
              <% end %>
            </td>
            <td>
              <%= link_to product, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-danger" do %>
                <i class="fa fa-remove" aria-hidden="true"></i> Destroy 
              <% end %>    
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<%= link_to new_product_path, class: "btn btn-info" do %>
  <i class="fa fa-plus" aria-hidden="true"></i> New Product
<% end %>
